<div class="container">

<table style="width: 100%;"><tr>
<td>ccSim</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Simulation function for case-control study designs.
</h2>

<h3>Description</h3>

<p>Monte Carlo based evaluation of operating characteristics of the maximum likelihood estimator (MLE) for the coefficients of a logistic regression model, based on the case-control.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ccSim(B=1000, betaTruth, X, N,  expandX="all", etaTerms=NULL,
      nCC, r, refDesign=1, alpha=0.05,
      threshold=c(-Inf, Inf), digits=1, betaNames=NULL,
      monitor=NULL, returnRaw=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>

<p>The number of datasets generated by the simulation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaTruth</code></td>
<td>

<p>Regression coefficients from the logistic regression model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>

<p>Design matrix for the logistic regression model. The first column should correspond to intercept. For each exposure, the baseline group should be coded as 0, the first level as 1, and so on.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>

<p>A numeric vector providing the sample size for each row of the design matrix, <code>X</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expandX</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> to expand as a series of dummy variables. Useful when at least one exposure is continuous (and should not be expanded). Default is ‘all’; other options include ‘none’ or character vector of column names. See Details, below.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>etaTerms</code></td>
<td>

<p>Character vector indicating which columns of <code>X</code> are to be included in the model. See Details, below.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nCC</code></td>
<td>

<p>A numeric value indicating the total case-control sample size. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>

<p>A numeric value indicating the control:case ratio in the case-control sample. If a vector is provided, separate simulations are run for each value.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refDesign</code></td>
<td>

<p>A numeric value indicating the control:case ratio for the referent design (for the relative uncertainty calculation).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>

<p>Type I error rate assumed for the evaluation of coverage probabilities and power.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>

<p>An interval that specifies truncation of the Monte Carlo sampling distribution of the MLE.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>

<p>Integer indicating the precision to be used for the output.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaNames</code></td>
<td>

<p>An optional character vector of names for the regression coefficients, <code>betaTruth</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>monitor</code></td>
<td>

<p>Numeric value indicating how often <code>ccSim()</code> reports real-time progress on the simulation, as the <code>B</code> datasets are generated and evaluated. The default of <code>NULL</code> indicates no output.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnRaw</code></td>
<td>

<p>Logical indicator of whether or not the raw coefficient and standard error estimates for each of the design/estimator combinations should be returned.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A simulation study is performed to evaluate the operating
characteristics of the MLE for <code>betaTruth</code> from a case-control
design (Prentice and Pyke, 1979). The operating characteristics are
evaluated using the Monte Carlo sampling distribution of the
estimator. The latter is generated using the following steps:
</p>

<ul>
<li>
<p>(i) Specify the (joint) marginal exposure distribution of underlying population, using <code>X</code> and <code>N</code>. 
</p>
</li>
<li>
<p>(ii) Simulate outcomes for all sum(<code>N</code>) individuals in the population, based on an underlying logistic regression model specified via <code>betaTruth</code>.
</p>
</li>
<li>
<p>(iii) Sample <code>n0</code> controls and <code>n1</code> cases, on the basis of <code>nCC</code> and <code>r</code>.
</p>
</li>
<li>
<p>(iv) Evaluate the MLE estimator, its estimated standard error and store the results.
</p>
</li>
<li>
<p>(v) Repeat steps (ii)-(iv) <code>B</code> times.
</p>
</li>
</ul>
<p>All case-control MLEs are evaluated using the generic <code>glm</code> function.
</p>
<p>The correspondence between <code>betaTruth</code> and <code>X</code>, specifically the ordering of elements, is based on successive use of <code>factor</code> to each column of <code>X</code> which is expanded via the <code>expandX</code> argument. Each exposure that is expanded must conform to a 0, 1, 2, ... integer-based coding convention.
</p>
<p>The <code>etaTerms</code> argument is useful when only certain columns in <code>X</code> are to be included in the model.
</p>
<p>When evaluating operating characteristics of the MLE, some simulated datasets may result in unusually large or small estimates. Particularly, when the the case-control sample size, <code>nCC</code>, is small. In some settings, it may be desirable to truncate the Monte Carlo sampling distribution prior to evaluating operating characteristics. The <code>threshold</code> argument indicates the interval beyond which MLEs are ignored. The default is such that all <code>B</code> datasets are kept.
</p>


<h3>Value</h3>

<p><code>ccSim()</code> returns an object of class "ccSim", a list containing all the input arguments, as well list <code>results</code> with the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>betaMean</code></td>
<td>

<p>Mean of the Monte Carlo sampling distribution for each regression coefficient estimator.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaMeanBias</code></td>
<td>

<p>Bias based on the mean, calculated as <code>betaMean</code> - <code>betaTruth</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaMeanPB</code></td>
<td>

<p>Percent bias based on mean, calculated as ((<code>betaMean</code> - <code>betaTruth</code>) / <code>betaTruth</code>) x 100. If a regression coefficient is
zero, percent bias is not calculated and an NA is returned.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaMedian</code></td>
<td>

<p>Median of the Monte Carlo sampling distribution for each regression coefficient estimator.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaMedianBias</code></td>
<td>

<p>Bias based on the median, calculated as <code>betaMedian</code> - <code>betaTruth</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaMedianPB</code></td>
<td>

<p>Percent bias based on median, calculated as ((<code>betaMedian</code> - <code>betaTruth</code>) / <code>betaTruth</code>) x 100. If a regression coefficient is
zero, median percent bias is not calculated and an NA is returned.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaSD</code></td>
<td>

<p>Standard deviation of the Monte Carlo sampling distribution for each regression coefficient estimator.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaMSE</code></td>
<td>

<p>Mean squared error of the Monte Carlo sampling distribution for each regression coefficient
estimator.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seMean</code></td>
<td>

<p>Mean of the Monte Carlo sampling distribution for the standard error estimates reported by glm().
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seRatio</code></td>
<td>

<p>Ratio of the mean reported standard error to the standard deviation of the Monte Carlo sampling
distribution for each regression coefficient estimator. The ratio is multiplied by 100.    
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaCP</code></td>
<td>

<p>Coverage probability for Wald-based confidence intervals, evaluated on the basis of an <code>alpha</code> type I error rate.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaPower</code></td>
<td>

<p>Power against the null hypothesis that the regression coefficient is zero for a Wald-based test with an <code>alpha</code> type I error rate.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaRU</code></td>
<td>

<p>The ratio of the standard deviation of the Monte Carlo sampling
distribution for each estimator to the standard deviation of the Monte Carlo sampling distribution
for the estimator corresponding to <code>refDesign</code>. The ratio is multiplied by 100.
</p>
</td>
</tr>
</table>
<p>Also returned is an object <code>failed</code> which is a vector consisting of the number of datasets excluded from the power calculations (i.e. set to <code>NA</code>), for each simulation performed. For the evaluation of general operating characteristics, the three reasons are: (1) lack of convergence indicated by <code>NA</code> point estimates returned by <code>glm</code>, (2) lack of convergence indicated by <code>NA</code> standard error point estimates returned by <code>glm</code>, (3) exclusion on the basis of the <code>threshold</code> argument.
</p>


<h3>Note</h3>

<p>A generic print method provides formatted output of the results.
</p>


<h3>Author(s)</h3>

<p>Sebastien Haneuse, Takumi Saegusa
</p>


<h3>References</h3>

<p>Prentice, R. and Pyke, R. (1979) "Logistic disease incidence models and case-control studies." Biometrika 66:403-411.
</p>
<p>Haneuse, S. and Saegusa, T. and Lumley, T. (2011) "osDesign: An R Package for the Analysis, Evaluation, and Design of Two-Phase and Case-Control Studies." Journal of Statistical Software, 43(11), 1-29.
</p>


<h3>See Also</h3>

<p><code>plotPower</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">##
data(Ohio)

## 
XM   &lt;- cbind(Int=1, Ohio[,1:3])
fitM &lt;- glm(cbind(Death, N-Death) ~ factor(Age) + Sex + Race, data=Ohio,
            family=binomial)
betaNamesM &lt;- c("Int", "Age1", "Age2", "Sex", "Race")

## Single case-control design
##
ccResults1 &lt;- ccSim(B=100, betaTruth=fitM$coef, X=XM, N=Ohio$N,
                    nCC=500, r=1, betaNames=betaNamesM, monitor=10)
ccResults1

## Examining unbalanced case-control designs
##

ccResults2 &lt;- ccSim(B=1000, betaTruth=fitM$coef, X=XM, N=Ohio$N,
                    nCC=500, r=c(0.25, 0.33, 0.5, 1, 2, 3, 4),
                    betaNames=betaNamesM, monitor=100)
ccResults2
</code></pre>


</div>